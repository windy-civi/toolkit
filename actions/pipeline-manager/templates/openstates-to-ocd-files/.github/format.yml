name: Format Data for âœï¸{ locale.key }âœï¸

on:
  # Triggered by scraper repo when scrape completes
  repository_dispatch:
    types: [scrape-complete]
  # Manual trigger
  workflow_dispatch:
    inputs:
      force-update:
        type: boolean
        description: "Force push even if upstream changed (use with caution)"
        default: false

env:
  STATE_CODE: âœï¸{ locale.key }âœï¸
  SCRAPER_REPO: chn-openstates-scrapers/âœï¸{ locale.key }âœï¸-legislation

jobs:
  format:
    name: "ğŸ“ Format Data"
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout files repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Clone scraper repo for data
        run: |
          echo "ğŸ“¥ Cloning data from ${{ env.SCRAPER_REPO }}..."
          git clone --depth 1 https://github.com/${{ env.SCRAPER_REPO }}.git scraper-data

          # Check if _data folder exists
          if [ -d "scraper-data/_data/${{ env.STATE_CODE }}" ]; then
            echo "âœ… Found scraped data in _data/${{ env.STATE_CODE }}"
            ls -la scraper-data/_data/${{ env.STATE_CODE }}/ | head -20
          else
            echo "âŒ No scraped data found in _data/${{ env.STATE_CODE }}"
            exit 1
          fi

      - name: Run formatter action
        uses: windy-civi/toolkit/actions/format@âœï¸{ locale.toolkit_branch }âœï¸
        with:
          state: ${{ env.STATE_CODE }}
          github-token: ${{ secrets.GITHUB_TOKEN }}
          scrape-data-path: scraper-data/_data/${{ env.STATE_CODE }}
          force-update: ${{ inputs.force-update }}

