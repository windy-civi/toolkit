# govbot development tasks
# Install just: cargo install just
# Then run: just --list to see all available tasks

# Default task: show help
default:
    @just --list

# Setup development environment
setup:
    #!/usr/bin/env bash
    set -e
    echo "üöÄ Setting up development environment..."
    
    # Check if Rust is installed
    if ! command -v cargo &> /dev/null; then
        echo "‚ùå Error: Rust/Cargo is not installed."
        echo "   Please install Rust from https://rustup.rs/"
        exit 1
    fi
    
    echo "‚úÖ Rust toolchain found: $(rustc --version)"
    
    # Install Rust dependencies
    echo ""
    echo "üì¶ Installing Rust dependencies..."
    cargo build
    
    # Install cargo-insta if not present
    if ! command -v cargo-insta &> /dev/null; then
        echo ""
        echo "üì¶ Installing cargo-insta (required for snapshot testing)..."
        cargo install cargo-insta
    else
        echo "‚úÖ cargo-insta already installed: $(cargo-insta --version 2>/dev/null || echo 'installed')"
    fi

    # Copy snapshots from sync-windy-civi-pipelines
    rm -rf .tmp/.govbot/repos
    mkdir -p .tmp/.govbot/repos
    cp -r ../sync-windy-civi-pipelines/__snapshots__/* .tmp/.govbot/repos/
    
    # Generate locale enum from pipeline-manager config
    echo ""
    echo "üìù Generating locale enum from pipeline-manager config..."
    cargo run --bin generate-locale-enum

    echo ""
    echo "‚úÖ Development environment setup complete!"
    echo ""
    echo "Next steps:"
    echo "  - Run tests: just test"
    echo "  - Review snapshots: just review"
    echo "  - Build release: just build-release"

# Build the project (debug)
build:
    cargo build

# Build the project (release)
build-release:
    cargo build --release

# Run all tests
test:
    cargo test

# Run tests with output
test-verbose:
    cargo test -- --nocapture

# Run a specific test
test-single TEST:
    cargo test {{TEST}}

# Review snapshot changes
review:
    cargo insta review

# Accept all snapshot changes
accept:
    cargo insta accept

# Reject all snapshot changes
reject:
    cargo insta reject

# Format code
fmt:
    cargo fmt

# Check formatting
fmt-check:
    cargo fmt -- --check

# Run clippy
clippy:
    cargo clippy -- -D warnings

# Run clippy with fixes
clippy-fix:
    cargo clippy --fix --allow-dirty

# Run all checks (format, clippy, tests)
check:
    just fmt-check
    just clippy
    just test

# Clean build artifacts
clean:
    cargo clean

# Run the CLI with example arguments
run:
    cargo run

# Run the CLI with custom arguments
run-args ARGS:
    cargo run -- {{ARGS}}

# Run the release binary
run-release:
    cargo run --release

# Generate locale enum from pipeline-manager config
generate:
    cargo run --bin generate-locale-enum

# Show project info
info:
    @echo "Project: govbot"
    @echo "Rust version: $(rustc --version)"
    @echo "Cargo version: $(cargo --version)"
    @echo ""
    @echo "Available tasks:"
    @just --list

